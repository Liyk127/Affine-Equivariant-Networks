# Affine Equivariant Networks Based on Differential Invariants

Official PyTorch implementation of the CVPR 2024 paper [Affine Equivariant Networks Based on Differential Invariants](https://openaccess.thecvf.com/content/CVPR2024/papers/Li_Affine_Equivariant_Networks_Based_on_Differential_Invariants_CVPR_2024_paper.pdf) by Yikang Li, Yeqing Qiu, Yuxuan Chen, Lingshen He, and Zhouchen Lin.

## Environment
```
numpy==1.24.4
python==3.8.17
rbf==2022.6.12+17.gad934a8
scipy==1.10.1
torch==1.12.0+cu113
torchvision==0.13.0+cu113
```
(For installation of the `rbf` package, see [RBF](https://github.com/treverhines/RBF)) 

## Datasets
The following datasets are used in the experiments. Please download or generate the datasets as described below, and place them in the `data` directory under the corresponding subfolders:

1. **Scale-MNIST** and **Scale-Fashion**: These datasets are generated by applying scale transformations to the original MNIST and Fashion-MNIST datasets, respectively. The datasets can be generated using the code available in the [SS-CNN repository](https://github.com/rghosh92/SS-CNN). Place the generated datasets in the `data/Scale-MNIST` and `data/Scale-Fashion` folders.

2. **RS-MNIST** and **RS-Fashion**: These datasets are obtained by applying rotation and scale transformations to the original MNIST and Fashion-MNIST datasets. The datasets can be generated using the code available in the [Roto-scale-translation-Equivariant-CNN repository](https://github.com/gaoliyao/Roto-scale-translation-Equivariant-CNN). Place the generated datasets in the `data/RS-MNIST` and `data/RS-Fashion` folders.

3. **affNIST**: This dataset is created by applying affine transformations to the original MNIST dataset. Download the dataset from the [affNIST official website](https://www.cs.toronto.edu/~tijmen/affNIST/), and place the downloaded files (`training.mat` and `affNIST_test.mat`) in the `data/affNIST` folder.


## Experiments
We implement our equivariant models, **InvarPDEs-Net** and **InvarLayer**, for three non-Euclidean groups: the scale group, the rotation-scale group, and the affine group.
To evaluate the performance of these models, we conduct classification experiments on image datasets with different group transformations.
This section provides instructions for reproducing the experiments in the paper.
### Scale Equivariance
 * InvarPDEs-Net
```bash
# Scale-MNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset Scale-MNIST --model InvarPDEs_Net_scale --channel 65 --hidden 65 --iter 16 --learning_rate 2e-3 --epochs 60
# Scale-Fashion
CUDA_VISIBLE_DEVICES=0 python main.py --dataset Scale-Fashion --model InvarPDEs_Net_scale --channel 65 --hidden 65 --iter 16 --learning_rate 2e-3 --epochs 60
```

 * InvarLayer
```bash
# Scale-MNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset Scale-MNIST --model InvarLayer_scale --learning_rate 2e-3 --epochs 60
# Scale-Fashion
CUDA_VISIBLE_DEVICES=0 python main.py --dataset Scale-Fashion --model InvarLayer_scale --learning_rate 2e-3 --epochs 60
```

### Rotation-Scale Equivariance
 * InvarPDEs-Net
```bash
# RS-MNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset RS-MNIST --model InvarPDEs_Net_RS --channel 25 --hidden 43 --iter 16 --learning_rate 2e-3 --epochs 60
# RS-Fashion
CUDA_VISIBLE_DEVICES=0 python main.py --dataset RS-Fashion --model InvarPDEs_Net_RS --channel 25 --hidden 43 --iter 16 --learning_rate 2e-3 --epochs 60
```

 * InvarLayer
```bash
# RS-MNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset RS-MNIST --model InvarLayer_RS --learning_rate 8e-3 --epochs 60
# RS-Fashion
CUDA_VISIBLE_DEVICES=0 python main.py --dataset RS-Fashion --model InvarLayer_RS --learning_rate 8e-3 --epochs 60
```


### Affine Equivariance
 * InvarPDEs-Net
```bash
# affNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset affNIST --model InvarPDEs_Net_affine --channel 45 --hidden 45 --iter 15 --learning_rate 1e-3 --epochs 90
```
 * InvarLayer
```bash
# affNIST
CUDA_VISIBLE_DEVICES=0 python main.py --dataset affNIST --model InvarLayer_affine --learning_rate 1e-3 --epochs 90
```

## Citation
If you find this work helpful in your research, please consider citing our paper:
```bibtex
@inproceedings{li2024affine,
title={Affine Equivariant Networks Based on Differential Invariants},
author={Li, Yikang and Qiu, Yeqing and Chen, Yuxuan and He, Lingshen and Lin, Zhouchen},
booktitle={Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition},
pages={5546--5556},
year={2024}
}
```